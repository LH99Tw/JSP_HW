<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%
    // Ïñ∏Ïñ¥ ÏÑ§Ï†ï (Ïù¥ÎØ∏ ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏúºÎ©¥ ÏÇ¨Ïö©, ÏóÜÏúºÎ©¥ Í∏∞Î≥∏Í∞í)
    String language = (String) session.getAttribute("language");
    if (language == null) {
        javax.servlet.http.Cookie[] cookies = request.getCookies();
        if (cookies != null) {
            for (javax.servlet.http.Cookie cookie : cookies) {
                if ("language".equals(cookie.getName())) {
                    language = cookie.getValue();
                    session.setAttribute("language", language);
                    break;
                }
            }
        }
        if (language == null) {
            language = "ko";
        }
    }
    
    java.util.Locale locale;
    switch (language) {
        case "en":
            locale = java.util.Locale.ENGLISH;
            break;
        case "ja":
            locale = java.util.Locale.JAPANESE;
            break;
        default:
            locale = java.util.Locale.KOREAN;
    }
    pageContext.setAttribute("locale", locale);
    pageContext.setAttribute("language", language);
%>
<fmt:setLocale value="${locale}" />
<fmt:setBundle basename="i18n.messages" var="messages" />
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><c:if test="${not empty param.pageTitle}">${param.pageTitle} - </c:if>JSP Homework</title>
    <link rel="stylesheet" href="${pageContext.request.contextPath}/css/style.css">
    <link rel="stylesheet" href="${pageContext.request.contextPath}/css/vscode-style.css">
</head>
<body>
    <div class="vscode-container">
        <!-- ÏÉÅÎã® Î©îÎâ¥ Î∞î -->
        <div class="vscode-topbar">
            <form id="search-form" style="flex: 1; max-width: 400px;">
                <input type="text" 
                       id="search-input"
                       class="search-box" 
                       placeholder="<fmt:message key="search_placeholder" bundle="${messages}" /> (Ïòà: setting:--)"
                       value="${param.q != null ? param.q : ''}">
            </form>
            <div class="menu-items">
                <a href="${pageContext.request.contextPath}/upload"><fmt:message key="file_upload" bundle="${messages}" /></a>
                <span style="color: var(--vscode-text-secondary);">${sessionScope.username}</span>
                <a href="${pageContext.request.contextPath}/logout"><fmt:message key="logout" bundle="${messages}" /></a>
            </div>
        </div>
        
        <!-- Î©îÏù∏ ÏòÅÏó≠ -->
        <div class="vscode-main">
            <!-- Activity Bar (Ï¢åÏ∏° ÏµúÏô∏Í≥Ω) -->
            <div class="activity-bar">
                <button class="activity-item active" data-activity="explorer" title="ÌÉêÏÉâÍ∏∞" onclick="switchActivity('explorer')">
                    <span class="icon">üìÅ</span>
                </button>
                <button class="activity-item" data-activity="visualization" title="ÏãúÍ∞ÅÌôî" onclick="switchActivity('visualization')">
                    <span class="icon">üìä</span>
                </button>
                <button class="activity-item" data-activity="settings" title="ÏÑ§Ï†ï" onclick="switchActivity('settings')">
                    <span class="icon">‚öôÔ∏è</span>
                </button>
            </div>
            
            <!-- Ï¢åÏ∏° ÏÇ¨Ïù¥ÎìúÎ∞î -->
            <div class="vscode-sidebar">
                <!-- ÌÉêÏÉâÍ∏∞ Activity -->
                <div class="sidebar-content" id="explorer-content">
                    <div class="sidebar-header">
                        <span>ÌÉêÏÉâÍ∏∞</span>
                        <div>
                            <button class="sidebar-action" title="ÏÉà ÌååÏùº" onclick="alert('Phase 3ÏóêÏÑú Íµ¨ÌòÑ ÏòàÏ†ï')">+</button>
                            <button class="sidebar-action" title="ÏÉàÎ°úÍ≥†Ïπ®" onclick="loadFileList()">üîÑ</button>
                        </div>
                    </div>
                    <div style="flex: 1; overflow-y: auto; padding: 0.5rem;">
                        <ul class="file-tree" id="file-tree">
                            <li class="file-tree-item" onclick="loadAllFiles()">
                                <span class="icon">üìÅ</span>
                                <span class="name">Î™®Îì† ÌååÏùº</span>
                            </li>
                            <!-- ÌååÏùº Î™©Î°ùÏùÄ JavaScriptÎ°ú ÎèôÏ†Å Î°úÎìú -->
                        </ul>
                    </div>
                </div>
                
                <!-- ÏãúÍ∞ÅÌôî Activity -->
                <div class="sidebar-content" id="visualization-content" style="display: none;">
                    <div class="sidebar-header">
                        <span>ÏãúÍ∞ÅÌôî</span>
                    </div>
                    <div style="padding: 1rem; color: var(--vscode-text-secondary);">
                        <p><fmt:message key="visualization" bundle="${messages}" /> Í∏∞Îä•ÏùÄ Phase 3ÏóêÏÑú Íµ¨ÌòÑÎê©ÎãàÎã§.</p>
                    </div>
                </div>
                
                <!-- ÏÑ§Ï†ï Activity -->
                <div class="sidebar-content" id="settings-content" style="display: none;">
                    <div class="sidebar-header">
                        <span>ÏÑ§Ï†ï</span>
                    </div>
                    <div style="padding: 1rem;">
                        <div style="margin-bottom: 1.5rem;">
                            <h3 style="font-size: 13px; margin-bottom: 0.5rem; color: var(--vscode-text);"><fmt:message key="language" bundle="${messages}" /></h3>
                            <form method="post" action="${pageContext.request.contextPath}/language">
                                <select name="lang" onchange="this.form.submit()" 
                                        style="width: 100%; padding: 0.5rem; background-color: var(--vscode-bg); color: var(--vscode-text); border: 1px solid var(--vscode-border); border-radius: 2px;">
                                    <option value="ko" ${language == 'ko' ? 'selected' : ''}>ÌïúÍµ≠Ïñ¥</option>
                                    <option value="en" ${language == 'en' ? 'selected' : ''}>English</option>
                                    <option value="ja" ${language == 'ja' ? 'selected' : ''}>Êó•Êú¨Ë™û</option>
                                </select>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ï§ëÏïô ÏûëÏóÖ ÏòÅÏó≠ -->
            <div class="vscode-workspace">
                <!-- ÌÉ≠ Î∞î -->
                <div class="vscode-tabs" id="tabs-container">
                    <!-- ÌÉ≠ÏùÄ JavaScriptÎ°ú ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê® -->
                </div>
                
                <!-- ÏóêÎîîÌÑ∞/Î∑∞Ïñ¥ ÏòÅÏó≠ -->
                <div class="vscode-editor" id="editor-container">
                    <!-- ÌéòÏù¥ÏßÄÎ≥Ñ ÏΩòÌÖêÏ∏†Í∞Ä Ïó¨Í∏∞Ïóê ÏÇΩÏûÖÎê® -->
