# 프로젝트 개발 명세서

## 1. 프로젝트 개요

### 1.1 프로젝트 목적
- JSP/Servlet 기반 웹 애플리케이션 개발
- 머신러닝 모델을 활용한 지능형 웹 서비스 구현
- 마이크로서비스 아키텍처 기반 분산 시스템 구축

### 1.2 주요 기능
- 사용자 인증 및 권한 관리 (세션/쿠키 기반)
- 파일 업로드 및 다운로드 기능
- 다국어 지원 (i18n)
- 머신러닝 모델 연동 (예: 이미지 분류, 텍스트 분석 등)
- 데이터 시각화 및 대시보드
- RESTful API 제공

## 2. 시스템 아키텍처

```
┌─────────────────┐
│   Web Browser   │
└────────┬────────┘
         │ HTTP/HTTPS
         ▼
┌─────────────────────────────────┐
│   Apache Tomcat 9.x (WAS)       │
│   ┌──────────────────────────┐  │
│   │  JSP/Servlet Layer       │  │
│   │  - JSP Pages             │  │
│   │  - Servlets              │  │
│   │  - Filters               │  │
│   │  - Session Management    │  │
│   └──────────────────────────┘  │
└────────┬────────────────────────┘
         │
         ├─────────────────┬──────────────────┐
         ▼                 ▼                  ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ PostgreSQL   │  │  FastAPI ML  │  │  File Store  │
│  14+ (RDB)   │  │   Container  │  │   (Volume)   │
└──────────────┘  └──────────────┘  └──────────────┘
```

## 3. 기술 스택 상세

### 3.1 Backend (Web Layer – JSP/Servlet)
- **Java**: JDK 11 이상
- **JSP/Servlet**: Servlet API 4.0+
- **JSTL**: JSTL 1.2 (표준 태그 라이브러리)
- **EL (Expression Language)**: JSP EL 3.0+
- **필터 및 리스너**: Servlet Filter, Session Listener
- **의존성 관리**: Maven 또는 Gradle
- **로깅**: Log4j2 또는 SLF4J

### 3.2 ML Model Layer (Python)
- **Python**: 3.9 이상
- **FastAPI**: 0.100.0+ (ML 서버 프레임워크)
- **Uvicorn**: 0.23.0+ (ASGI Server)
- **ML 라이브러리**: 
  - scikit-learn, TensorFlow, PyTorch 등 (프로젝트 요구사항에 따라)
- **데이터 처리**: NumPy, Pandas
- **API 통신**: httpx, requests

### 3.3 WAS (Web Application Server)
- **Apache Tomcat**: 9.x
- **포트**: 8080 (기본)
- **컨텍스트 경로**: `/app` 또는 루트 `/`
- **세션 타임아웃**: 30분
- **인코딩**: UTF-8

### 3.4 Main RDB
- **PostgreSQL**: 14 이상
- **포트**: 5432
- **인코딩**: UTF-8
- **연결 풀**: HikariCP 또는 Tomcat JDBC Pool
- **ORM/매퍼**: MyBatis 또는 JPA (선택사항)

### 3.5 Container
- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **컨테이너 구성**:
  - `tomcat-container`: JSP/Servlet 애플리케이션
  - `fastapi-ml-container`: ML 모델 서버
  - `postgres-container`: 데이터베이스 서버

### 3.6 CI/CD
- **GitHub Actions**: 자동 빌드 및 배포
- **워크플로우**:
  - 코드 푸시 시 자동 빌드
  - 테스트 실행
  - Docker 이미지 빌드
  - 컨테이너 배포

## 4. 프로젝트 구조

```
JSP_HW/
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/example/
│   │   │       ├── servlet/
│   │   │       ├── filter/
│   │   │       ├── listener/
│   │   │       ├── dao/
│   │   │       ├── service/
│   │   │       └── util/
│   │   ├── webapp/
│   │   │   ├── WEB-INF/
│   │   │   │   ├── web.xml
│   │   │   │   ├── classes/
│   │   │   │   └── lib/
│   │   │   ├── jsp/
│   │   │   │   ├── common/
│   │   │   │   ├── user/
│   │   │   │   ├── admin/
│   │   │   │   └── error/
│   │   │   ├── css/
│   │   │   ├── js/
│   │   │   ├── images/
│   │   │   └── uploads/
│   │   └── resources/
│   │       └── i18n/
│   │           ├── messages_ko.properties
│   │           ├── messages_en.properties
│   │           └── messages_ja.properties
│   └── test/
├── ml-service/
│   ├── app/
│   │   ├── main.py
│   │   ├── models/
│   │   ├── routers/
│   │   └── utils/
│   ├── requirements.txt
│   └── Dockerfile
├── docker/
│   ├── docker-compose.yml
│   ├── Dockerfile.tomcat
│   └── init.sql
├── .github/
│   └── workflows/
│       └── ci-cd.yml
├── pom.xml (또는 build.gradle)
├── .gitignore
└── README.md
```

## 5. 주요 기능 요구사항

### 5.1 JSP 기본 기능 구현
- **스크립트 태그**:
  - `<% %>`: 스크립틀릿 (Java 코드)
  - `<%= %>`: 표현식 (출력)
  - `<%! %>`: 선언부 (변수/메서드 선언)
  
- **디렉티브 태그**:
  - `<%@ page %>`: 페이지 설정 (인코딩, import, 세션 등)
  - `<%@ include %>`: 정적 include
  - `<%@ taglib %>`: 커스텀 태그 라이브러리
  
- **액션 태그**:
  - `<jsp:include>`: 동적 include
  - `<jsp:forward>`: 페이지 포워딩
  - `<jsp:useBean>`: JavaBean 사용
  - `<jsp:setProperty>` / `<jsp:getProperty>`: 속성 설정/조회
  
- **내장 객체 활용**:
  - `request`: 요청 정보
  - `response`: 응답 제어
  - `session`: 세션 관리
  - `application`: 애플리케이션 컨텍스트
  - `pageContext`: 페이지 컨텍스트
  - `out`: 출력 스트림
  - `config`: 서블릿 설정
  - `page`: 현재 페이지 객체
  - `exception`: 예외 처리

### 5.2 폼 처리 및 유효성 검사
- **폼 태그**: `<form>`, `<input>`, `<select>`, `<textarea>` 등
- **클라이언트 측 유효성 검사**: JavaScript
- **서버 측 유효성 검사**: Servlet/JSP에서 처리
- **파일 업로드**: `multipart/form-data` 처리
  - Apache Commons FileUpload 또는 Servlet 3.0+ Part API 사용

### 5.3 세션 및 쿠키 관리
- **세션 (HttpSession 사용)**:
  - JSP/Servlet의 기본 `HttpSession` 객체 활용
  - `session.setAttribute()`, `session.getAttribute()` 사용
  - 로그인 상태 유지 (예: `session.setAttribute("user", user)`)
  - 장바구니 기능
  - 사용자별 설정 저장
  - 세션 타임아웃 처리 (`web.xml`에서 설정)
  - 세션 무효화: `session.invalidate()`
  - **참고**: 기본적으로 Tomcat은 메모리에 세션을 저장하며, DB 저장은 클러스터링 환경 등 특수한 경우에만 필요
  
- **쿠키**:
  - `Cookie` 객체 생성 및 `response.addCookie()` 사용
  - 자동 로그인 (Remember Me)
  - 언어 설정 저장
  - 최근 본 항목 저장
  - 쿠키 읽기: `request.getCookies()` 사용

### 5.4 다국어 처리 (i18n)
- **ResourceBundle** 활용
- **언어별 properties 파일**:
  - `messages_ko.properties` (한국어)
  - `messages_en.properties` (영어)
  - `messages_ja.properties` (일본어)
- **언어 선택**: 쿠키 또는 세션 기반
- **JSTL fmt 태그**: `<fmt:message>` 사용

### 5.5 데이터베이스 연동
- **JDBC 연결**: Connection Pool 사용
- **CRUD 작업**: 
  - Create: INSERT
  - Read: SELECT
  - Update: UPDATE
  - Delete: DELETE
- **트랜잭션 관리**
- **SQL Injection 방지**: PreparedStatement 사용

### 5.6 ML 모델 연동
- **FastAPI 엔드포인트 호출**: HTTP 클라이언트 사용
- **ML 기능 예시**:
  - 이미지 분류
  - 텍스트 감정 분석
  - 추천 시스템
  - 예측 모델
- **비동기 처리**: 필요 시 비동기 요청

## 6. 데이터베이스 설계

### 6.1 주요 테이블

**참고**: 세션 관리는 JSP/Servlet의 기본 `HttpSession`을 사용하므로 별도의 DB 테이블이 필요하지 않습니다. 
DB에 세션을 저장하는 것은 클러스터링 환경(여러 서버 간 세션 공유)이나 세션 영속성(서버 재시작 후 유지)이 필요한 특수한 경우에만 사용합니다.

#### users (사용자)
```sql
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    full_name VARCHAR(100),
    language VARCHAR(10) DEFAULT 'ko',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### uploads (파일 업로드)
```sql
CREATE TABLE uploads (
    upload_id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(user_id),
    original_filename VARCHAR(255) NOT NULL,
    stored_filename VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size BIGINT,
    content_type VARCHAR(100),
    uploaded_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### ml_results (ML 결과)
```sql
CREATE TABLE ml_results (
    result_id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(user_id),
    upload_id INTEGER REFERENCES uploads(upload_id),
    model_type VARCHAR(50),
    input_data TEXT,
    prediction_result TEXT,
    confidence_score DECIMAL(5,4),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 7. API 명세

### 7.1 JSP/Servlet 엔드포인트
- `GET /`: 메인 페이지
- `GET /login`: 로그인 페이지
- `POST /login`: 로그인 처리
- `GET /logout`: 로그아웃
- `GET /register`: 회원가입 페이지
- `POST /register`: 회원가입 처리
- `GET /upload`: 파일 업로드 페이지
- `POST /upload`: 파일 업로드 처리
- `GET /ml/analyze`: ML 분석 페이지
- `POST /ml/analyze`: ML 분석 요청

### 7.2 FastAPI ML 서비스 엔드포인트
- `GET /health`: 헬스 체크
- `POST /api/v1/predict`: 예측 요청
- `POST /api/v1/classify`: 분류 요청
- `GET /api/v1/models`: 사용 가능한 모델 목록

## 8. 개발 환경 설정

### 8.1 필수 도구
- **JDK**: 11 이상
- **Docker Desktop**: 컨테이너 실행
- **Git**: 버전 관리

### 8.2 로컬 개발 환경
1. PostgreSQL 로컬 설치 또는 Docker 컨테이너 사용
2. Tomcat 로컬 설치 또는 Docker 컨테이너 사용
3. FastAPI ML 서비스 로컬 실행 또는 Docker 컨테이너 사용
4. 데이터베이스 초기화 스크립트 실행

## 9. 배포 전략

### 9.1 Docker Compose 구성
- 모든 서비스를 하나의 `docker-compose.yml`로 관리
- 네트워크: bridge 네트워크 사용
- 볼륨: 데이터 영속성을 위한 볼륨 마운트
- 환경 변수: `.env` 파일로 관리

### 9.2 CI/CD 파이프라인
1. **빌드 단계**: Maven/Gradle 빌드
2. **테스트 단계**: 단위 테스트 실행
3. **이미지 빌드**: Docker 이미지 생성
4. **배포 단계**: Docker Compose로 서비스 시작

## 10. 평가 기준

### 10.1 기본 평가 요소 (필수)
- ✅ **스크립트 태그**: 스크립틀릿, 표현식, 선언부 적절히 사용
- ✅ **디렉티브 태그**: page, include, taglib 디렉티브 활용
- ✅ **액션 태그**: include, forward, useBean 등 사용
- ✅ **내장 객체**: request, response, session, application 등 활용
- ✅ **폼 태그**: 다양한 폼 요소 사용 및 처리
- ✅ **파일 업로드**: multipart 데이터 처리 구현
- ✅ **유효성 검사**: 클라이언트/서버 측 검증 구현
- ✅ **다국어 처리**: ResourceBundle 및 fmt 태그 사용
- ✅ **세션 관리**: 로그인/로그아웃, 세션 데이터 활용
- ✅ **쿠키 처리**: 쿠키 생성, 읽기, 삭제 구현
- ✅ **데이터베이스 연동**: JDBC를 통한 CRUD 작업
- ✅ **예외 처리**: try-catch 및 에러 페이지 구현

### 10.2 평가 요소

#### 창의성 (30점)
- 독창적인 기능 구현
- 사용자 경험(UX) 개선
- ML 모델의 창의적 활용
- UI/UX 디자인

#### 구체성 (30점)
- 명확한 요구사항 반영
- 상세한 기능 구현
- 완전한 데이터베이스 설계
- 체계적인 코드 구조

#### 완성도 (40점)
- 모든 필수 기능 구현
- 버그 없는 동작
- 에러 처리 및 예외 상황 대응
- 코드 품질 및 주석
- 문서화 (README, API 문서)

### 10.3 추가 평가 항목
- **코드 품질**: 가독성, 유지보수성, 네이밍 규칙
- **보안**: SQL Injection 방지, XSS 방지, 인증/인가
- **성능**: 데이터베이스 쿼리 최적화, 연결 풀 사용
- **테스트**: 단위 테스트, 통합 테스트
- **문서화**: README, API 문서, 주석


## 11. 참고 자료

- JSP/Servlet 공식 문서
- PostgreSQL 공식 문서
- FastAPI 공식 문서
- Docker 공식 문서
- GitHub Actions 문서