# 개인지식저장소 시각화 서비스 (Personal Knowledge Repository Visualization Service)

## 1. 서비스 개요

### 1.1 서비스 목적
사용자가 업로드한 문서와 파일을 체계적으로 관리하고, 머신러닝 기반 유사도 분석을 통해 지식 간의 연결 관계를 시각화하는 개인 지식 관리 플랫폼입니다.

### 1.2 핵심 가치
- **직관적인 파일 관리**: VSCode 스타일의 익숙한 UI/UX
- **지능형 시각화**: ML 기반 문서 유사도 분석 및 그래프 시각화
- **다국어 지원**: 한국어, 영어, 일본어 지원
- **안전한 데이터 관리**: 세션/쿠키 기반 인증 및 보안

---

## 2. 핵심 기능 상세

### 2.1 사용자 인증 및 권한 관리

#### 2.1.1 회원가입
- **JSP 기술 요소**:
  - `<form>` 태그를 사용한 회원가입 폼
  - `<input>` 태그: username, email, password, full_name 입력
  - JavaScript 클라이언트 측 유효성 검사
  - 서블릿에서 서버 측 유효성 검사 (PreparedStatement 사용)
- **기능**:
  - 이메일 중복 체크 (AJAX)
  - 비밀번호 강도 검증
  - 데이터베이스에 사용자 정보 저장 (PostgreSQL)
  - 회원가입 성공 시 자동 로그인

#### 2.1.2 로그인/로그아웃
- **JSP 기술 요소**:
  - `session.setAttribute()` / `session.getAttribute()` 사용
  - `session.invalidate()` 로그아웃 처리
  - 쿠키를 통한 "Remember Me" 기능
- **기능**:
  - 세션 기반 로그인 상태 유지
  - 자동 로그인 (쿠키 활용)
  - 로그인 실패 횟수 제한
  - 마지막 로그인 시간 기록

### 2.2 파일 관리 시스템

#### 2.2.1 파일 업로드
- **JSP 기술 요소**:
  - `<form enctype="multipart/form-data">` 사용
  - Servlet 3.0+ `Part` API 또는 Apache Commons FileUpload
  - `request.getPart()` 파일 처리
- **기능**:
  - 다중 파일 업로드 지원
  - 파일 타입 검증 (서버 측)
  - 파일 크기 제한 (예: 10MB)
  - 원본 파일명 저장 및 고유 파일명 생성
  - 업로드 진행률 표시 (AJAX)
  - 데이터베이스에 파일 메타데이터 저장

#### 2.2.2 파일 탐색기 (VSCode 스타일)
- **JSP 기술 요소**:
  - `<jsp:include>` 동적 include로 사이드바 구성
  - `<jsp:useBean>` 파일 목록 JavaBean 사용
  - `application` 내장 객체로 공유 리소스 관리
- **UI 구성**:
  - 좌측 사이드바: 폴더 트리 구조
  - 중앙 영역: 파일 목록 및 미리보기
  - 상단 탭: 여러 파일 동시 열기
  - 우측 상단: 메모 패널 토글 버튼
- **기능**:
  - 폴더 생성/삭제/이름 변경
  - 파일 이동/복사/삭제
  - 파일 검색 (상단 검색창)
  - 파일 미리보기 (텍스트, 이미지)
  - 파일 다운로드

#### 2.2.3 파일 편집 및 저장
- **JSP 기술 요소**:
  - `<jsp:forward>` 파일 편집 페이지로 포워딩
  - `request.getParameter()` 편집 내용 수신
- **기능**:
  - 텍스트 파일 실시간 편집
  - Cmd+S / Ctrl+S 단축키 저장
  - 저장 버튼 클릭 저장
  - 자동 저장 (선택사항)
  - 수정 이력 관리

### 2.3 지식 시각화 (Knowledge Visualization)

#### 2.3.1 그래프 뷰 (Obsidian 스타일)
- **JSP 기술 요소**:
  - `<%@ include %>` 정적 include로 공통 헤더/푸터
  - JavaScript와 AJAX로 동적 데이터 로딩
  - `session` 내장 객체로 사용자별 시각화 설정 저장
- **시각화 요소**:
  - **노드 (Node)**: 각 문서/파일을 나타냄
  - **엣지 (Edge)**: 문서 간 연결 관계
  - **노드 크기**: 문서 중요도 또는 크기
  - **연결 강도**: ML 기반 유사도 점수
  - **색상**: 문서 카테고리 또는 태그

#### 2.3.2 ML 기반 유사도 분석
- **FastAPI ML 서비스 연동**:
  - 문서 텍스트 추출 및 전처리
  - TF-IDF 또는 Word2Vec 기반 유사도 계산
  - 문서 간 코사인 유사도 계산
  - 결과를 데이터베이스에 저장 (`ml_results` 테이블)
- **최적화 전략**:
  - 배치 처리: 새 파일 업로드 시에만 분석
  - 캐싱: 계산된 유사도 결과 재사용
  - 점진적 업데이트: 변경된 파일만 재분석
- **JSP 연동**:
  - `HttpURLConnection` 또는 Apache HttpClient로 FastAPI 호출
  - 비동기 처리 (AJAX)
  - 진행률 표시

#### 2.3.3 시각화 설정
- **JSP 기술 요소**:
  - `<jsp:setProperty>` / `<jsp:getProperty>` 설정 저장
  - 쿠키로 사용자 설정 저장
- **설정 옵션**:
  - 레이아웃 알고리즘 선택 (Force-directed, Hierarchical 등)
  - 노드 크기 기준 (파일 크기, 중요도, 유사도)
  - 연결 임계값 설정
  - 색상 테마 선택

### 2.4 다국어 지원 (i18n)

#### 2.4.1 언어 선택
- **JSP 기술 요소**:
  - `ResourceBundle` 사용
  - `<fmt:message>` JSTL 태그
  - 쿠키로 언어 설정 저장
  - `session`으로 현재 언어 관리
- **지원 언어**:
  - 한국어 (ko) - 기본
  - 영어 (en)
  - 일본어 (ja)
- **구현**:
  - 언어 선택 드롭다운
  - `messages_ko.properties`, `messages_en.properties`, `messages_ja.properties`
  - 모든 텍스트 리소스화

### 2.5 검색 및 필터링

#### 2.5.1 통합 검색
- **JSP 기술 요소**:
  - `request.getParameter("query")` 검색어 수신
  - `PreparedStatement`로 SQL Injection 방지
- **검색 기능**:
  - 파일명 검색
  - 파일 내용 검색 (텍스트 파일)
  - 태그 검색
  - 고급 검색 (날짜, 파일 타입, 크기)

#### 2.5.2 설정 명령어 (Command Palette)
- **기능**:
  - `setting:--` 형식으로 설정 탭 열기
  - `file:--` 형식으로 파일 검색
  - `tag:--` 형식으로 태그 검색
  - VSCode 스타일 명령 팔레트

### 2.6 메모 및 주석

#### 2.6.1 파일 연동 메모
- **JSP 기술 요소**:
  - `application` 내장 객체로 메모 공유
  - AJAX로 실시간 저장
- **기능**:
  - 파일별 메모 작성
  - 마크다운 지원
  - 메모 검색
  - 메모 내보내기

### 2.7 설정 관리

#### 2.7.1 계정 정보 관리
- **JSP 기술 요소**:
  - `<jsp:useBean>` 사용자 정보 JavaBean
  - 세션에서 사용자 정보 가져오기
- **기능**:
  - 프로필 수정
  - 비밀번호 변경
  - 계정 삭제

#### 2.7.2 테마 및 UI 설정
- **JSP 기술 요소**:
  - 쿠키로 테마 설정 저장
  - CSS 클래스 동적 변경
- **기능**:
  - 다크 모드 / 라이트 모드
  - 색상 테마 선택
  - 폰트 크기 조절

#### 2.7.3 데이터 관리
- **기능**:
  - 전체 데이터 백업 (ZIP 다운로드)
  - 데이터 내보내기 (JSON, CSV)
  - 데이터 가져오기

---

## 3. JSP 기술 요소 구현 상세

### 3.1 스크립트 태그 활용

#### 3.1.1 스크립틀릿 (`<% %>`)
```jsp
<%
    String username = (String) session.getAttribute("username");
    if (username == null) {
        response.sendRedirect("login.jsp");
        return;
    }
    
    // 데이터베이스에서 파일 목록 가져오기
    List<FileInfo> files = fileService.getUserFiles(username);
    request.setAttribute("files", files);
%>
```

#### 3.1.2 표현식 (`<%= %>`)
```jsp
<p>환영합니다, <%= username %>님!</p>
<p>현재 시간: <%= new java.util.Date() %></p>
```

#### 3.1.3 선언부 (`<%! %>`)
```jsp
<%!
    private String formatFileSize(long size) {
        if (size < 1024) return size + " B";
        if (size < 1024 * 1024) return (size / 1024) + " KB";
        return (size / (1024 * 1024)) + " MB";
    }
%>
```

### 3.2 디렉티브 태그 활용

#### 3.2.1 Page 디렉티브 (`<%@ page %>`)
```jsp
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ page import="java.util.List" %>
<%@ page import="com.example.model.FileInfo" %>
<%@ page session="true" %>
<%@ page errorPage="/jsp/error/error.jsp" %>
```

#### 3.2.2 Include 디렉티브 (`<%@ include %>`)
```jsp
<%@ include file="/jsp/common/header.jspf" %>
<!-- 페이지 내용 -->
<%@ include file="/jsp/common/footer.jspf" %>
```

#### 3.2.3 Taglib 디렉티브 (`<%@ taglib %>`)
```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
```

### 3.3 액션 태그 활용

#### 3.3.1 Include 액션 (`<jsp:include>`)
```jsp
<jsp:include page="/jsp/common/sidebar.jsp">
    <jsp:param name="currentPage" value="files" />
</jsp:include>
```

#### 3.3.2 Forward 액션 (`<jsp:forward>`)
```jsp
<%
    if (!isAuthenticated) {
%>
    <jsp:forward page="/jsp/user/login.jsp" />
<%
    }
%>
```

#### 3.3.3 UseBean 액션 (`<jsp:useBean>`)
```jsp
<jsp:useBean id="fileInfo" class="com.example.model.FileInfo" scope="request">
    <jsp:setProperty name="fileInfo" property="*" />
</jsp:useBean>

파일명: <jsp:getProperty name="fileInfo" property="filename" />
```

### 3.4 내장 객체 활용

#### 3.4.1 Request 객체
```jsp
<%
    String query = request.getParameter("search");
    String[] tags = request.getParameterValues("tags");
    String userAgent = request.getHeader("User-Agent");
    String contextPath = request.getContextPath();
%>
```

#### 3.4.2 Response 객체
```jsp
<%
    response.setContentType("application/json");
    response.setCharacterEncoding("UTF-8");
    response.addCookie(new Cookie("language", "ko"));
    response.sendRedirect("success.jsp");
%>
```

#### 3.4.3 Session 객체
```jsp
<%
    session.setAttribute("currentFolder", "/documents");
    String currentFolder = (String) session.getAttribute("currentFolder");
    int timeout = session.getMaxInactiveInterval();
%>
```

#### 3.4.4 Application 객체
```jsp
<%
    Integer visitCount = (Integer) application.getAttribute("visitCount");
    if (visitCount == null) visitCount = 0;
    application.setAttribute("visitCount", visitCount + 1);
%>
```

#### 3.4.5 PageContext 객체
```jsp
<%
    pageContext.setAttribute("pageTitle", "파일 관리", PageContext.REQUEST_SCOPE);
    String title = (String) pageContext.getAttribute("pageTitle");
%>
```

### 3.5 폼 태그 및 유효성 검사

#### 3.5.1 폼 태그
```jsp
<form method="post" action="upload.jsp" enctype="multipart/form-data">
    <input type="text" name="filename" required />
    <input type="file" name="file" multiple accept=".txt,.pdf,.doc" />
    <select name="category">
        <option value="document">문서</option>
        <option value="image">이미지</option>
    </select>
    <textarea name="description"></textarea>
    <button type="submit">업로드</button>
</form>
```

#### 3.5.2 클라이언트 측 유효성 검사 (JavaScript)
```jsp
<script>
function validateForm() {
    var file = document.querySelector('input[name="file"]');
    if (file.files.length === 0) {
        alert('파일을 선택해주세요.');
        return false;
    }
    if (file.files[0].size > 10 * 1024 * 1024) {
        alert('파일 크기는 10MB를 초과할 수 없습니다.');
        return false;
    }
    return true;
}
</script>
```

#### 3.5.3 서버 측 유효성 검사 (Servlet)
```java
// Servlet에서
String filename = request.getParameter("filename");
if (filename == null || filename.trim().isEmpty()) {
    request.setAttribute("error", "파일명을 입력해주세요.");
    request.getRequestDispatcher("upload.jsp").forward(request, response);
    return;
}
```

### 3.6 데이터베이스 연동

#### 3.6.1 JDBC 연결 및 CRUD
```java
// DAO 클래스
public class FileDAO {
    public void insertFile(FileInfo file) throws SQLException {
        String sql = "INSERT INTO uploads (user_id, original_filename, stored_filename, file_path, file_size) VALUES (?, ?, ?, ?, ?)";
        try (Connection conn = DataSource.getConnection();
             PreparedStatement pstmt = conn.prepareStatement(sql)) {
            pstmt.setInt(1, file.getUserId());
            pstmt.setString(2, file.getOriginalFilename());
            pstmt.setString(3, file.getStoredFilename());
            pstmt.setString(4, file.getFilePath());
            pstmt.setLong(5, file.getFileSize());
            pstmt.executeUpdate();
        }
    }
}
```

#### 3.6.2 JSP에서 데이터 표시
```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<c:forEach var="file" items="${files}">
    <tr>
        <td>${file.originalFilename}</td>
        <td>${file.fileSize} bytes</td>
        <td><fmt:formatDate value="${file.uploadedAt}" pattern="yyyy-MM-dd HH:mm" /></td>
        <td>
            <a href="download.jsp?id=${file.uploadId}">다운로드</a>
            <a href="delete.jsp?id=${file.uploadId}">삭제</a>
        </td>
    </tr>
</c:forEach>
```

---

## 4. 개선 사항 및 추가 기능

### 4.1 성능 최적화
- **파일 업로드**:
  - 청크 업로드 (대용량 파일)
  - 진행률 표시 (WebSocket 또는 Server-Sent Events)
  - 비동기 업로드 (AJAX)
- **데이터베이스**:
  - Connection Pool 사용 (HikariCP)
  - 인덱스 최적화
  - 페이징 처리
- **캐싱**:
  - 파일 목록 캐싱
  - ML 분석 결과 캐싱

### 4.2 보안 강화
- **인증/인가**:
  - 비밀번호 해싱 (BCrypt)
  - CSRF 토큰
  - 세션 하이재킹 방지
- **파일 업로드 보안**:
  - 파일 타입 검증 (MIME 타입)
  - 파일 크기 제한
  - 악성 파일 스캔
- **SQL Injection 방지**:
  - PreparedStatement 사용
  - 입력값 검증 및 이스케이프

### 4.3 사용자 경험 개선
- **반응형 디자인**:
  - 모바일/태블릿 지원
  - 터치 제스처
- **접근성**:
  - 키보드 단축키
  - 스크린 리더 지원
  - 고대비 모드
- **오프라인 지원**:
  - Service Worker (PWA)
  - 로컬 스토리지 활용

### 4.4 고급 기능
- **협업 기능**:
  - 파일 공유
  - 댓글 및 주석
  - 버전 관리
- **알림 시스템**:
  - 파일 업로드 알림
  - 분석 완료 알림
  - 이메일 알림
- **통계 및 분석**:
  - 사용량 통계
  - 파일 타입 분포
  - 활동 로그

### 4.5 ML 기능 확장
- **문서 분류**:
  - 자동 카테고리 분류
  - 태그 자동 생성
- **요약 기능**:
  - 문서 자동 요약
  - 키워드 추출
- **추천 시스템**:
  - 유사 문서 추천
  - 관련 파일 추천

---

## 5. 페이지 구조 및 네비게이션

### 5.1 주요 페이지
1. **메인 페이지** (`/index.jsp`)
   - 대시보드
   - 최근 파일
   - 빠른 액세스

2. **로그인/회원가입** (`/jsp/user/login.jsp`, `/jsp/user/register.jsp`)
   - 폼 태그 활용
   - 유효성 검사

3. **파일 탐색기** (`/jsp/files/explorer.jsp`)
   - 사이드바 (include)
   - 파일 목록
   - 검색 기능

4. **파일 업로드** (`/jsp/files/upload.jsp`)
   - multipart/form-data
   - 진행률 표시

5. **지식 시각화** (`/jsp/visualization/graph.jsp`)
   - 그래프 뷰
   - ML 연동

6. **설정** (`/jsp/settings/index.jsp`)
   - 계정 관리
   - 테마 설정
   - 다국어 선택

7. **에러 페이지** (`/jsp/error/404.jsp`, `/jsp/error/500.jsp`)
   - 예외 처리

### 5.2 공통 컴포넌트
- **헤더** (`/jsp/common/header.jspf`)
- **사이드바** (`/jsp/common/sidebar.jsp`)
- **푸터** (`/jsp/common/footer.jspf`)
- **네비게이션** (`/jsp/common/nav.jsp`)

---

## 6. 데이터 흐름

### 6.1 파일 업로드 흐름
1. 사용자가 파일 선택 (JSP 폼)
2. JavaScript 유효성 검사
3. AJAX로 서버에 전송
4. 서블릿에서 서버 측 검증
5. 파일 저장 (디스크)
6. 메타데이터 저장 (PostgreSQL)
7. ML 서비스에 분석 요청 (비동기)
8. 결과 저장 및 응답

### 6.2 시각화 데이터 생성 흐름
1. 파일 업로드 완료
2. FastAPI ML 서비스 호출
3. 문서 텍스트 추출
4. 유사도 계산
5. 결과를 데이터베이스에 저장
6. 그래프 데이터 생성
7. 프론트엔드에 JSON 전달
8. D3.js 또는 vis.js로 시각화

---

## 7. 평가 요소 체크리스트

### ✅ 필수 구현 항목
- [x] 스크립트 태그 (스크립틀릿, 표현식, 선언부)
- [x] 디렉티브 태그 (page, include, taglib)
- [x] 액션 태그 (include, forward, useBean)
- [x] 내장 객체 (request, response, session, application, pageContext)
- [x] 폼 태그 및 처리
- [x] 파일 업로드 (multipart/form-data)
- [x] 유효성 검사 (클라이언트/서버)
- [x] 다국어 처리 (ResourceBundle, fmt 태그)
- [x] 세션 관리 (로그인/로그아웃)
- [x] 쿠키 처리 (언어 설정, Remember Me)
- [x] 데이터베이스 연동 (JDBC, CRUD)
- [x] 예외 처리 (에러 페이지)

### ✅ 추가 구현 항목
- [x] 필터 (CharacterEncodingFilter)
- [x] 리스너 (SessionListener)
- [x] 커스텀 태그 (선택사항)
- [x] EL 표현식 활용
- [x] JSTL 태그 라이브러리

---

## 8. 기술 스택 요약

### Backend
- **JSP/Servlet**: 웹 레이어
- **Java 11+**: 백엔드 언어
- **PostgreSQL**: 데이터베이스
- **Tomcat 9.x**: WAS

### ML Service
- **FastAPI**: ML 서버
- **Python 3.9+**: ML 언어
- **scikit-learn**: ML 라이브러리

### Frontend
- **HTML/CSS/JavaScript**: 기본 UI
- **D3.js / vis.js**: 그래프 시각화
- **AJAX**: 비동기 통신

### Infrastructure
- **Docker / Docker Compose**: 컨테이너화
- **GitHub Actions**: CI/CD

---

## 9. 개발 우선순위

### Phase 1: 기본 기능 (필수)
1. 사용자 인증 (로그인/회원가입)
2. 파일 업로드/다운로드
3. 파일 목록 표시
4. 기본 파일 관리 (CRUD)

### Phase 2: 핵심 기능
1. 파일 탐색기 UI
2. 파일 편집 기능
3. 검색 기능
4. 다국어 지원

### Phase 3: 고급 기능
1. ML 기반 유사도 분석
2. 그래프 시각화
3. 메모 기능
4. 설정 관리

### Phase 4: 개선 및 최적화
1. 성능 최적화
2. 보안 강화
3. 사용자 경험 개선
4. 추가 기능 구현

---

이 서비스 명세는 평가 요소를 모두 충족하면서도 실용적이고 창의적인 기능을 제공합니다.
